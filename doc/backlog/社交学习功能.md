# Backlog: 社交学习功能

## 功能概述

社交学习功能旨在打造一个量化策略学习社区，用户可以关注优秀创作者、Fork他人配置、参与讨论、观看策略复盘直播等。通过社交互动降低学习门槛，促进知识分享，提升平台活跃度。

## 核心价值

- **知识传播**：优质策略思路通过社交网络快速扩散
- **降低门槛**：新手通过学习高手经验快速成长
- **社区氛围**：互动和讨论增强用户归属感
- **用户粘性**：社交关系链提升留存率
- **内容生产**：UGC（用户生成内容）丰富平台内容

## 主要功能点

### 1. 用户关注与粉丝系统

**关注机制：**
- 关注用户（类似Twitter/微博）
- 查看关注列表、粉丝列表
- 互相关注（好友）
- 推荐关注（新用户引导、算法推荐）

**个人主页：**
- 用户基础信息（昵称、头像、简介、徽章）
- 数据统计：
  - 关注数、粉丝数
  - 公开配置数
  - 竞技场排名历史
  - 获得的点赞/收藏总数
- 内容展示：
  - 公开配置列表
  - 发布的帖子
  - 参与的讨论
  - 获得的成就

**动态流：**
- 首页显示关注用户的动态
- 动态类型：
  - 发布新配置
  - 配置进入竞技场Top 10
  - 发布策略分析文章
  - 参与话题讨论
- 支持点赞、评论、转发

### 2. 配置Fork机制

**Fork流程：**
1. 浏览公开配置，点击"Fork"按钮
2. 自动复制配置到"我的配置"
3. 标记来源（显示"Fork自 @用户名"）
4. 可在原基础上修改优化

**Fork关系链：**
- 显示Fork层级关系树（类似GitHub）
- 原创者可查看所有Fork分支
- Fork数量作为配置热度指标

**原创者收益分成：**
- Fork的配置如果在竞技场获奖，原创者获得5-10%分成
- Fork的配置在市场出售，原创者永久获得5%分成
- 鼓励开源分享

**Fork排行榜：**
- 最受欢迎配置（按Fork数排序）
- Fork后改进最大的配置（收益率提升）

### 3. 策略复盘与分享

**复盘文章：**
- 用户可针对某个配置撰写复盘文章
- 内容包括：
  - 策略思路来源
  - 参数选择依据
  - 历史回测分析
  - 失败案例与改进
  - 市场环境适配
- 支持Markdown格式、插入图表

**文章功能：**
- 发布、编辑、删除
- 关联配置（点击可直接查看/Fork配置）
- 点赞、收藏、评论
- 分享到社交平台

**内容审核：**
- 自动检测违规内容（广告、谩骂）
- 用户举报机制
- 优质内容推荐到首页

### 4. 社区论坛与话题讨论

**板块设计：**
- **新手入门**：基础知识、常见问题
- **策略交流**：策略思路讨论
- **市场分析**：行情解读、板块轮动
- **技术指标**：指标原理、参数优化
- **晒单区**：回测结果分享
- **吐槽区**：闲聊、反馈建议

**发帖功能：**
- 标题 + 正文（支持Markdown）
- 添加标签（如"MACD"、"震荡市"）
- 插入图片、图表
- @其他用户
- 设置帖子可见性（公开/仅粉丝）

**互动功能：**
- 点赞、踩、收藏
- 回复、引用回复
- 楼中楼（多层评论）
- 最佳答案标记（提问帖）

**话题（Tag）系统：**
- 热门话题榜（如#今日复盘#、#新手求助#）
- 话题订阅（关注感兴趣话题）
- 话题页面（聚合相关帖子）

### 5. 策略直播与视频教学

**直播功能：**
- 排行榜前10用户可申请直播权限
- 直播内容：
  - 策略复盘讲解
  - 实时参数调优过程
  - 问答互动
- 直播工具：
  - 屏幕共享（展示回测页面）
  - 语音/视频（讲解）
  - 弹幕互动
  - 打赏功能（虚拟礼物）

**录播与回放：**
- 直播结束自动生成回放
- 支持倍速播放、进度条拖拽
- 评论区讨论

**视频教程：**
- 官方制作新手教程（如"5分钟学会双均线"）
- 用户上传教学视频
- 视频分类：入门、进阶、高级

**打赏与激励：**
- 观众可打赏主播（虚拟礼物或积分）
- 主播获得积分分成（平台抽成30%）
- 月度优质主播奖励

### 6. 学习路径与导师系统

**新手引导路径：**
- 第1周：了解基础指标（MA、MACD）
- 第2周：学习简单策略（均线交叉）
- 第3周：尝试多策略组合
- 第4周：参与新手竞技场

**导师认证：**
- 竞技场长期Top 20可申请成为导师
- 导师权益：
  - 专属"导师"徽章
  - 可接收徒弟（最多10人）
  - 徒弟获奖导师有额外积分

**师徒系统：**
- 新手可申请拜师
- 导师可批准/拒绝
- 师徒关系展示在个人主页
- 徒弟出师条件：竞技场进入Top 100

### 7. 配置协作与团队

**团队功能：**
- 创建团队（如"稳健策略研究小组"）
- 邀请成员加入
- 团队内部共享配置（仅成员可见）
- 团队讨论区

**协作编辑：**
- 团队成员可共同编辑配置
- 版本管理（记录谁修改了什么）
- 权限管理（管理员/编辑/只读）

**团队竞技场：**
- 团队组队参加竞赛
- 团队总分 = 成员最佳配置平均分
- 团队排行榜

**团队成果分享：**
- 团队可联合发布研究报告
- 标注每个成员贡献

### 8. 积分与信誉体系

**积分获取：**
- 每日签到：+10积分
- 发布优质帖子（被推荐首页）：+100积分
- 配置被Fork：+20积分/次
- 竞技场获奖：50-1000积分
- 收到打赏：按比例获得积分

**积分消费：**
- 购买配置
- 打赏主播
- 兑换VIP会员
- 兑换实物礼品（如书籍、周边）

**信誉等级：**
- 根据积分、活跃度、贡献度综合计算
- 等级体系：
  - Lv1 新手（0-100积分）
  - Lv2 入门（100-500）
  - Lv3 熟手（500-2000）
  - Lv4 高手（2000-5000）
  - Lv5 大师（5000-10000）
  - Lv6 传奇（10000+）

**等级特权：**
- 等级越高，发帖权重越高（更容易上热门）
- 高等级可申请导师
- 高等级直播优先推荐

## 技术要点

### 数据库设计

```sql
-- 关注关系表
CREATE TABLE user_follows (
    follower_id BIGINT NOT NULL,  -- 关注者
    followee_id BIGINT NOT NULL,  -- 被关注者
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (follower_id, followee_id),
    FOREIGN KEY (follower_id) REFERENCES users(id),
    FOREIGN KEY (followee_id) REFERENCES users(id),
    INDEX idx_follower (follower_id),
    INDEX idx_followee (followee_id)
);

-- 动态表
CREATE TABLE user_activities (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    activity_type ENUM('new_config', 'arena_rank', 'post', 'comment'),
    content JSON NOT NULL,  -- 动态详细内容

    like_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    share_count INT DEFAULT 0,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
);

-- 帖子表
CREATE TABLE posts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    category ENUM('beginner', 'strategy', 'market', 'indicator', 'showcase', 'offtopic'),

    tags JSON,  -- 标签数组
    related_config_id BIGINT,  -- 关联配置

    like_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    view_count INT DEFAULT 0,
    favorite_count INT DEFAULT 0,

    is_pinned BOOLEAN DEFAULT FALSE,  -- 置顶
    is_featured BOOLEAN DEFAULT FALSE,  -- 推荐到首页

    status ENUM('active', 'deleted', 'banned') DEFAULT 'active',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (related_config_id) REFERENCES configurations(id),
    INDEX idx_user_id (user_id),
    INDEX idx_category (category),
    INDEX idx_created_at (created_at),
    FULLTEXT INDEX ft_title_content (title, content)
);

-- 评论表
CREATE TABLE comments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    post_id BIGINT,
    config_id BIGINT,
    user_id BIGINT NOT NULL,
    parent_id BIGINT,  -- 父评论ID（楼中楼）

    content TEXT NOT NULL,
    like_count INT DEFAULT 0,

    status ENUM('active', 'deleted') DEFAULT 'active',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (post_id) REFERENCES posts(id),
    FOREIGN KEY (config_id) REFERENCES configurations(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (parent_id) REFERENCES comments(id),

    INDEX idx_post_id (post_id),
    INDEX idx_config_id (config_id),
    INDEX idx_user_id (user_id),
    INDEX idx_parent_id (parent_id)
);

-- 直播表
CREATE TABLE live_streams (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    host_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,

    stream_url VARCHAR(500),  -- 推流地址
    playback_url VARCHAR(500),  -- 回放地址

    viewer_count INT DEFAULT 0,
    like_count INT DEFAULT 0,
    gift_revenue DECIMAL(10, 2) DEFAULT 0,  -- 打赏收益

    status ENUM('scheduled', 'live', 'ended') DEFAULT 'scheduled',

    started_at TIMESTAMP,
    ended_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (host_id) REFERENCES users(id),
    INDEX idx_host_id (host_id),
    INDEX idx_status (status)
);

-- 团队表
CREATE TABLE teams (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    avatar_url VARCHAR(500),

    creator_id BIGINT NOT NULL,
    member_count INT DEFAULT 1,

    status ENUM('active', 'disbanded') DEFAULT 'active',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (creator_id) REFERENCES users(id),
    INDEX idx_creator_id (creator_id)
);

-- 团队成员表
CREATE TABLE team_members (
    team_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    role ENUM('admin', 'editor', 'member') DEFAULT 'member',

    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (team_id, user_id),
    FOREIGN KEY (team_id) REFERENCES teams(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 师徒关系表
CREATE TABLE mentor_relationships (
    mentor_id BIGINT NOT NULL,
    apprentice_id BIGINT NOT NULL,

    status ENUM('pending', 'active', 'graduated', 'cancelled') DEFAULT 'pending',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    graduated_at TIMESTAMP,

    PRIMARY KEY (mentor_id, apprentice_id),
    FOREIGN KEY (mentor_id) REFERENCES users(id),
    FOREIGN KEY (apprentice_id) REFERENCES users(id),
    INDEX idx_mentor (mentor_id),
    INDEX idx_apprentice (apprentice_id)
);
```

### API设计

```
# 关注系统
POST   /api/v1/users/:id/follow           # 关注用户
DELETE /api/v1/users/:id/follow           # 取消关注
GET    /api/v1/users/:id/followers        # 粉丝列表
GET    /api/v1/users/:id/following        # 关注列表
GET    /api/v1/users/recommended          # 推荐关注

# 个人主页
GET    /api/v1/users/:id/profile          # 用户主页
GET    /api/v1/users/:id/activities       # 用户动态

# Fork
POST   /api/v1/configs/:id/fork           # Fork配置
GET    /api/v1/configs/:id/forks          # 查看Fork列表
GET    /api/v1/configs/popular-forks      # Fork排行榜

# 帖子
POST   /api/v1/posts                      # 发布帖子
GET    /api/v1/posts                      # 帖子列表（支持分类、标签筛选）
GET    /api/v1/posts/:id                  # 帖子详情
PUT    /api/v1/posts/:id                  # 编辑帖子
DELETE /api/v1/posts/:id                  # 删除帖子
POST   /api/v1/posts/:id/like             # 点赞
POST   /api/v1/posts/:id/favorite         # 收藏

# 评论
POST   /api/v1/posts/:id/comments         # 发布评论
GET    /api/v1/posts/:id/comments         # 评论列表
POST   /api/v1/comments/:id/like          # 点赞评论
DELETE /api/v1/comments/:id               # 删除评论

# 话题
GET    /api/v1/topics                     # 话题列表
GET    /api/v1/topics/:tag                # 话题页（聚合帖子）
GET    /api/v1/topics/trending            # 热门话题

# 直播
POST   /api/v1/live/start                 # 开始直播
POST   /api/v1/live/:id/end               # 结束直播
GET    /api/v1/live                       # 直播列表
GET    /api/v1/live/:id                   # 直播详情
POST   /api/v1/live/:id/gift              # 打赏

# 团队
POST   /api/v1/teams                      # 创建团队
GET    /api/v1/teams                      # 团队列表
GET    /api/v1/teams/:id                  # 团队详情
POST   /api/v1/teams/:id/invite           # 邀请成员
POST   /api/v1/teams/:id/join             # 加入团队
GET    /api/v1/teams/:id/configs          # 团队配置

# 师徒
POST   /api/v1/mentors/:id/apply          # 申请拜师
POST   /api/v1/mentors/applications/:id/approve  # 导师批准
GET    /api/v1/mentors                    # 导师列表
GET    /api/v1/mentors/my-apprentices     # 我的徒弟

# 积分
GET    /api/v1/points/history             # 积分历史
POST   /api/v1/points/exchange            # 积分兑换
```

### 实时通信（WebSocket）

**推送事件：**
- 新粉丝通知
- 评论/点赞通知
- @提醒
- 直播开始通知
- 徒弟出师通知

**实现方案：**
- Socket.io（Node.js）或 Flask-SocketIO
- Redis作为消息队列
- 用户上线时订阅个人频道

### 前端实现

**页面结构：**
- `/community` - 社区首页（动态流）
- `/users/:id` - 用户主页
- `/posts` - 论坛帖子列表
- `/posts/:id` - 帖子详情
- `/live` - 直播广场
- `/live/:id` - 直播间
- `/teams` - 团队列表
- `/teams/:id` - 团队主页

**核心组件：**
- `ActivityFeed` - 动态流
- `UserCard` - 用户卡片
- `PostCard` - 帖子卡片
- `CommentList` - 评论列表
- `LivePlayer` - 直播播放器
- `GiftPanel` - 打赏面板

## 优先级

**P0（MVP）：**
- 关注系统
- 个人主页
- 配置Fork
- 基础论坛（发帖、评论）

**P1（重要）：**
- 动态流
- 话题系统
- 策略复盘文章
- 积分体系

**P2（可选）：**
- 直播功能
- 师徒系统
- 团队协作
- 视频教程

## 依赖关系

**前置依赖：**
- 用户账户系统
- 配置管理系统

**后置依赖：**
- 无

## 风险与挑战

1. **内容质量**：
   - 低质量灌水帖泛滥
   - 解决方案：积分门槛、审核机制、用户举报

2. **社区氛围**：
   - 争吵、谩骂、恶意攻击
   - 解决方案：敏感词过滤、禁言机制、社区公约

3. **版权问题**：
   - Fork是否侵犯原创者权益
   - 解决方案：明确协议、收益分成

4. **直播成本**：
   - 带宽、存储成本高
   - 解决方案：限制直播时长、接入第三方CDN

## 成功指标

- 日活跃用户（DAU）> 1000
- 每日发帖量 > 50
- 平均每帖评论数 > 5
- Fork率（Fork数/公开配置数）> 30%
- 关注关系数 > 5000对
- 直播观看人次 > 500/场

## 参考案例

- GitHub：Fork机制、社交网络
- 知乎：问答社区、话题系统
- B站：直播、打赏、弹幕
- Discord：团队协作、频道系统
