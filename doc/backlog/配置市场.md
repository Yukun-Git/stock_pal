# Backlog: 配置市场

## 功能概述

配置市场是一个用户间交易优质策略配置的平台。高排名或优质配置的创作者可以将配置上架出售，其他用户通过积分或付费购买。平台提供交易撮合、分成结算、评价反馈等功能，形成策略知识的流通闭环。

## 核心价值

- **知识变现**：优质策略创作者获得收益，激励持续优化
- **降低门槛**：新手直接购买成熟策略，快速上手
- **价值发现**：通过市场定价机制筛选真正有价值的策略
- **平台盈利**：抽取交易佣金，形成可持续商业模式
- **社区生态**：买卖双方互动，形成良性生态

## 主要功能点

### 1. 配置上架

**上架条件：**
- 配置已公开
- 在竞技场至少运行3个月
- 排名进入某赛道Top 50 或 综合评分 > 70
- 配置描述完整（包含策略思路、适用场景、风险提示）

**上架流程：**
1. 选择要上架的配置
2. 填写商品信息：
   - 商品标题（吸引人的标题）
   - 详细描述（策略原理、适用市场、历史表现）
   - 价格设置（固定价格或拍卖）
   - 销售方式（买断/订阅）
3. 审核（平台审核是否符合规范）
4. 上架成功

**定价建议：**
- 平台根据竞技场排名、收益率、稳定性给出参考价格
- 卖家可自主调整（±50%范围内）
- 显示"推荐价格"和"当前价格"

**销售方式：**
- **买断制**：一次性支付，永久使用
- **订阅制**：按月/季/年付费，到期失效
- **信号推送**：不出售配置本身，只推送交易信号（防泄露）

### 2. 市场浏览与搜索

**首页展示：**
- **热门推荐**：销量最高的配置
- **新品上架**：最近7天上架
- **高分配置**：竞技场高排名
- **限时折扣**：促销活动

**分类筛选：**
- 策略类型：均线、MACD、KDJ、组合策略
- 风险等级：保守、稳健、激进
- 价格区间：0-100、100-500、500+积分
- 销售方式：买断/订阅
- 适用市场：牛市、熊市、震荡市

**排序方式：**
- 综合排序（销量 + 评分 + 收益率）
- 价格：从低到高/从高到低
- 销量：畅销优先
- 最新上架

**搜索功能：**
- 关键词搜索（配置名、策略类型）
- 高级搜索（多条件组合）

### 3. 配置详情页

**基础信息：**
- 配置名称、封面图（可选）
- 创作者信息（用户名、徽章、信誉等级）
- 价格、销售方式
- 销量、收藏数、评分（5星）

**性能展示：**
- 竞技场历史排名曲线
- 收益率曲线（可展示最近3个月样本外数据）
- 关键指标卡片：年化收益、夏普比率、最大回撤、胜率
- 在不同股票上的表现（表格展示）

**策略说明：**
- 策略思路（文字描述）
- 适用场景（牛市/熊市/震荡市）
- 风险提示（最大可能亏损、不适用场景）
- 参数列表（可展开查看，但不暴露核心逻辑）

**用户评价：**
- 评分分布（5星、4星...占比）
- 评价列表（最新/最热）
- 好评标签云（如"稳健"、"回撤小"、"适合新手"）

**操作按钮：**
- 立即购买
- 加入购物车（支持批量购买）
- 收藏
- 举报（虚假宣传、侵权等）

### 4. 购买与支付

**购买流程：**
1. 点击"立即购买"或购物车结算
2. 确认订单（配置名、价格、销售方式）
3. 选择支付方式：
   - 积分支付（平台虚拟积分）
   - 真实货币支付（支付宝/微信，需接入支付接口）
4. 支付成功，配置自动添加到"我的配置"

**订单管理：**
- 订单列表：待支付、已完成、已退款
- 订单详情：配置信息、支付时间、订单号
- 发票申请（如果支持）

**退款政策：**
- 购买后7天内，如配置严重不符描述可申请退款
- 平台审核退款理由
- 退款后配置从"我的配置"移除

### 5. 卖家中心

**销售数据看板：**
- 总销售额（积分/现金）
- 总订单数
- 今日/本周/本月销量
- 销售趋势图

**商品管理：**
- 在售商品列表
- 编辑商品信息（价格、描述）
- 下架商品
- 查看商品数据（浏览量、收藏量、转化率）

**订单管理：**
- 销售订单列表
- 退款申请处理

**收益提现：**
- 可提现余额（扣除平台抽成后）
- 提现申请（绑定支付宝/银行卡）
- 提现记录

**数据分析：**
- 热销时段分析
- 买家画像（风险偏好、地域分布）
- 竞品对比（同类策略价格对比）

### 6. 评价与反馈

**购买后评价：**
- 使用配置至少7天后可评价
- 评分：1-5星
- 评价内容：文字评价（必填）+ 标签选择（如"稳健"、"收益高"）
- 晒单：可上传自己的回测截图

**卖家回复：**
- 卖家可回复用户评价
- 解释策略使用方法、回应质疑

**有用投票：**
- 其他用户可对评价点"有用"
- 有用数高的评价排序靠前

### 7. 防欺诈与保护机制

**配置保护：**
- **加密传输**：配置JSON加密存储
- **水印机制**：购买的配置绑定买家ID，防止二次倒卖
- **使用限制**：买断配置仅限购买者使用，不可公开分享

**质量保证：**
- **样本外验证**：展示最近1个月的实时回测数据（卖家无法优化）
- **虚假宣传检测**：AI识别过度夸大的描述
- **用户举报**：支持举报虚假配置，审核后下架并处罚

**交易安全：**
- **担保交易**：买家支付后资金暂存平台，确认收货后结算给卖家
- **纠纷仲裁**：买卖双方纠纷由平台客服介入
- **黑名单机制**：多次违规的卖家禁止上架

### 8. 激励与推广

**卖家激励：**
- **新手扶持**：新卖家首单免抽成
- **爆款奖励**：月销量Top 10额外奖励积分
- **优质创作者认证**：长期高评分卖家获得"认证卖家"标识

**买家激励：**
- **首购优惠**：新用户首次购买8折
- **推荐返利**：购买后推荐给朋友，成交后返10%积分
- **会员特权**：VIP会员购买配置9折

**平台推广：**
- **每周精选**：编辑推荐优质配置
- **策略大赛**：获奖配置免费开放1周
- **限时秒杀**：促销活动

## 技术要点

### 数据库设计

```sql
-- 商品表
CREATE TABLE marketplace_products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    config_id BIGINT NOT NULL UNIQUE,  -- 关联配置表
    seller_id BIGINT NOT NULL,

    -- 商品信息
    title VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    cover_image VARCHAR(500),

    -- 定价
    price DECIMAL(10, 2) NOT NULL,  -- 积分价格
    real_price DECIMAL(10, 2),      -- 真实货币价格（元）
    sale_type ENUM('buyout', 'subscription', 'signal') DEFAULT 'buyout',
    subscription_period ENUM('monthly', 'quarterly', 'yearly'),  -- 订阅周期

    -- 销售数据
    sales_count INT DEFAULT 0,
    view_count INT DEFAULT 0,
    favorite_count INT DEFAULT 0,
    rating DECIMAL(3, 2) DEFAULT 0,  -- 平均评分
    review_count INT DEFAULT 0,

    -- 状态
    status ENUM('pending', 'approved', 'rejected', 'on_sale', 'off_shelf') DEFAULT 'pending',
    reject_reason TEXT,

    -- 时间戳
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    approved_at TIMESTAMP,

    FOREIGN KEY (config_id) REFERENCES configurations(id),
    FOREIGN KEY (seller_id) REFERENCES users(id),
    INDEX idx_seller_id (seller_id),
    INDEX idx_status (status),
    INDEX idx_sales_count (sales_count),
    INDEX idx_rating (rating)
);

-- 订单表
CREATE TABLE marketplace_orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(50) UNIQUE NOT NULL,  -- 订单号

    buyer_id BIGINT NOT NULL,
    seller_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,

    -- 订单金额
    total_amount DECIMAL(10, 2) NOT NULL,
    payment_type ENUM('points', 'real_money'),

    -- 分成
    platform_commission DECIMAL(10, 2),  -- 平台抽成
    seller_revenue DECIMAL(10, 2),       -- 卖家收益

    -- 订单状态
    status ENUM('pending', 'paid', 'completed', 'refunded', 'cancelled') DEFAULT 'pending',

    -- 时间戳
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    paid_at TIMESTAMP,
    completed_at TIMESTAMP,

    FOREIGN KEY (buyer_id) REFERENCES users(id),
    FOREIGN KEY (seller_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES marketplace_products(id),

    INDEX idx_buyer_id (buyer_id),
    INDEX idx_seller_id (seller_id),
    INDEX idx_order_no (order_no),
    INDEX idx_status (status)
);

-- 评价表
CREATE TABLE marketplace_reviews (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    buyer_id BIGINT NOT NULL,

    -- 评价内容
    rating INT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    content TEXT NOT NULL,
    tags JSON,  -- 标签数组，如 ["稳健", "收益高"]
    images JSON,  -- 晒单图片数组

    -- 卖家回复
    seller_reply TEXT,
    replied_at TIMESTAMP,

    -- 统计
    helpful_count INT DEFAULT 0,  -- 有用数

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (order_id) REFERENCES marketplace_orders(id),
    FOREIGN KEY (product_id) REFERENCES marketplace_products(id),
    FOREIGN KEY (buyer_id) REFERENCES users(id),

    INDEX idx_product_id (product_id),
    INDEX idx_buyer_id (buyer_id),
    INDEX idx_rating (rating)
);

-- 购买记录（用户拥有的配置）
CREATE TABLE user_purchased_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    config_id BIGINT NOT NULL,
    order_id BIGINT NOT NULL,

    -- 订阅信息
    is_subscription BOOLEAN DEFAULT FALSE,
    expires_at TIMESTAMP,  -- 订阅到期时间

    -- 水印信息
    watermark VARCHAR(100),  -- 唯一标识，防止倒卖

    purchased_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (config_id) REFERENCES configurations(id),
    FOREIGN KEY (order_id) REFERENCES marketplace_orders(id),

    UNIQUE KEY uk_user_config (user_id, config_id),
    INDEX idx_user_id (user_id),
    INDEX idx_expires_at (expires_at)
);

-- 提现记录
CREATE TABLE seller_withdrawals (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    seller_id BIGINT NOT NULL,

    amount DECIMAL(10, 2) NOT NULL,
    payment_account VARCHAR(200) NOT NULL,  -- 支付宝/银行卡

    status ENUM('pending', 'approved', 'rejected', 'completed') DEFAULT 'pending',
    reject_reason TEXT,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,

    FOREIGN KEY (seller_id) REFERENCES users(id),
    INDEX idx_seller_id (seller_id),
    INDEX idx_status (status)
);
```

### API设计

```
# 市场浏览
GET    /api/v1/marketplace/products           # 商品列表（筛选、排序、分页）
GET    /api/v1/marketplace/products/:id       # 商品详情
GET    /api/v1/marketplace/search             # 搜索商品
GET    /api/v1/marketplace/categories         # 分类列表
GET    /api/v1/marketplace/hot                # 热门推荐
GET    /api/v1/marketplace/new                # 新品上架

# 购买流程
POST   /api/v1/marketplace/cart               # 加入购物车
GET    /api/v1/marketplace/cart               # 获取购物车
DELETE /api/v1/marketplace/cart/:id           # 移除购物车
POST   /api/v1/marketplace/orders             # 创建订单
POST   /api/v1/marketplace/orders/:id/pay     # 支付订单
GET    /api/v1/marketplace/orders             # 我的订单列表
GET    /api/v1/marketplace/orders/:id         # 订单详情
POST   /api/v1/marketplace/orders/:id/refund  # 申请退款

# 卖家中心
POST   /api/v1/seller/products                # 上架商品
PUT    /api/v1/seller/products/:id            # 编辑商品
DELETE /api/v1/seller/products/:id            # 下架商品
GET    /api/v1/seller/products                # 我的商品列表
GET    /api/v1/seller/dashboard               # 销售数据看板
GET    /api/v1/seller/orders                  # 销售订单
POST   /api/v1/seller/withdraw                # 提现申请
GET    /api/v1/seller/withdrawals             # 提现记录

# 评价
POST   /api/v1/marketplace/reviews            # 发布评价
GET    /api/v1/marketplace/products/:id/reviews  # 商品评价列表
POST   /api/v1/marketplace/reviews/:id/helpful   # 标记有用
POST   /api/v1/seller/reviews/:id/reply       # 卖家回复评价

# 收藏
POST   /api/v1/marketplace/favorites          # 收藏商品
DELETE /api/v1/marketplace/favorites/:id      # 取消收藏
GET    /api/v1/marketplace/favorites          # 我的收藏
```

### 平台抽成规则

```
基础抽成：20%
卖家等级优惠：
- 新手卖家（销售额 < 1000）：15%
- 普通卖家（1000-5000）：20%
- 优质卖家（5000-10000）：18%
- 金牌卖家（> 10000）：15%

买家支付 100 积分：
- 平台抽成：20 积分
- 卖家收益：80 积分
```

### 前端实现

**页面结构：**
- `/marketplace` - 市场首页
- `/marketplace/products/:id` - 商品详情
- `/marketplace/cart` - 购物车
- `/marketplace/orders` - 我的订单
- `/seller` - 卖家中心
- `/seller/products` - 商品管理
- `/seller/dashboard` - 数据看板

**核心组件：**
- `ProductCard` - 商品卡片
- `ProductDetail` - 商品详情
- `ShoppingCart` - 购物车
- `OrderList` - 订单列表
- `ReviewForm` - 评价表单
- `SellerDashboard` - 卖家数据看板

## 优先级

**P0（MVP）：**
- 商品上架审核
- 市场浏览与搜索
- 积分支付购买
- 订单管理
- 简单评价系统

**P1（重要）：**
- 卖家中心
- 收益提现
- 退款机制
- 订阅制
- 防欺诈机制

**P2（可选）：**
- 真实货币支付
- 信号推送模式
- 推荐返利
- 限时促销
- 数据分析看板

## 依赖关系

**前置依赖：**
- 用户账户系统（买卖双方）
- 配置管理系统（配置作为商品）
- 竞技场（质量验证）

**后置依赖：**
- 无

## 风险与挑战

1. **配置泄露风险**：
   - 买家购买后倒卖或公开分享
   - 解决方案：水印、订阅制、法律协议

2. **定价混乱**：
   - 卖家恶意低价竞争或虚高定价
   - 解决方案：平台指导价、价格区间限制

3. **虚假宣传**：
   - 卖家夸大收益率、隐瞒风险
   - 解决方案：样本外验证、审核机制

4. **支付安全**：
   - 真实货币支付需要支付牌照
   - 解决方案：初期仅支持积分，后期接入第三方支付

5. **税务合规**：
   - 卖家收益可能涉及个人所得税
   - 解决方案：平台代扣代缴或用户自行申报

## 成功指标

- 上架商品数 > 100
- 月成交订单数 > 500
- 平均客单价 > 200积分
- 买家复购率 > 30%
- 好评率 > 85%
- 退款率 < 5%

## 参考案例

- 淘宝/天猫：电商交易流程
- Steam创意工坊：游戏道具交易
- TradingView脚本市场：策略买卖
- 知识星球：知识付费
