# KDJ Cross 策略参数设计文档

**策略ID**: `kdj_cross`
**策略名称**: KDJ金叉
**文档版本**: v1.0
**创建日期**: 2025-11-11

---

## 参数设计概述

本文档定义了KDJ金叉策略的所有可配置参数。KDJ指标（随机指标）由K值、D值、J值三条曲线组成，是一个非常敏感的短期技术指标，广泛应用于捕捉短期买卖时机。

---

## KDJ指标原理简述

### 指标构成
- **K值（快线）**：当前价格在近期价格区间中的相对位置
- **D值（慢线）**：K值的移动平均，更平滑
- **J值（超快线）**：J = 3K - 2D，最灵敏

### 数值范围
- 正常范围：0-100
- 超买区：>70或>80
- 超卖区：<30或<20

### 核心逻辑
- **金叉**：K线上穿D线，看涨信号
- **死叉**：K线下穿D线，看跌信号
- **超卖区金叉**：信号最强（本策略核心）

---

## 参数分类

### 1. 基础参数

#### 1.1 时间周期

| 参数名 | 类型 | 默认值 | 可选值 | 说明 |
|--------|------|--------|--------|------|
| `timeframe` | select | `D` | `D`(日线), `W`(周线) | 策略运行的时间周期 |

**设计说明**：
- KDJ是短期指标，主要用于日线级别
- 周线级别KDJ更稳定，但信号较少

---

#### 1.2 KDJ计算周期

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `period` | integer | 9 | 5-30 | KDJ指标的计算周期（N日RSV） |

**设计说明**：
- **默认值9天**：经典设置，广泛使用
- **短周期（5-7天）**：更灵敏，适合超短线，但假信号多
- **长周期（14-21天）**：更稳定，适合波段，但滞后明显

**注意**：本策略暂未将period作为可配置参数，使用固定值9。如需优化，可在Phase 2添加。

---

### 2. 信号阈值参数

#### 2.1 超卖阈值

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `oversold` | integer | 30 | 10-40 | KDJ低于此值视为超卖区域 |

**设计说明**：
- **标准值30**：平衡信号质量和频率
- **激进值20**：深度超卖，信号更可靠但更少
- **保守值40**：放宽超卖标准，增加交易机会

**阈值选择指导**：
- K值<20：极度超卖，反弹概率>70%
- K值<30：标准超卖，反弹概率~60%
- K值<40：偏弱势，反弹概率~50%

---

#### 2.2 超买阈值

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `overbought` | integer | 70 | 60-90 | KDJ高于此值视为超买区域 |

**设计说明**：
- **标准值70**：经典超买区
- **激进值80**：深度超买，回调概率高
- **保守值60**：提前卖出，降低风险

**注意**：
本策略卖出信号为"K值进入超买区"，而非"金叉后K值下穿D值"
这种设计简化了卖出逻辑，但可能导致卖出时机略早。

---

## 信号生成逻辑

### 买入信号（超卖区金叉）
```
条件1：K线上穿D线（金叉）
条件2：金叉发生时K值在超卖区（K < oversold）

逻辑：
  if K[t-1] <= D[t-1] and K[t] > D[t] and K[t] < oversold:
      signal = BUY

注意：必须在超卖区金叉，常规金叉不交易
```

**设计理由**：
- 超卖区金叉 = 底部反转信号
- 常规金叉（如K=50时）信号较弱，不交易

### 卖出信号（进入超买区）
```
条件：K值超过超买阈值

逻辑：
  if K[t] > overbought:
      signal = SELL

注意：这是简化的卖出逻辑，也可改为"超买区死叉"
```

---

## 参数优化建议

### 优化目标维度

1. **提高胜率**：
   - 使用更严格的超卖阈值（oversold=20）
   - 增加确认条件（如J值也在超卖区）

2. **增加交易频率**：
   - 放宽超卖阈值（oversold=40）
   - 缩短KDJ周期（period=5）

3. **平衡收益与风险**：
   - 标准设置（oversold=30, overbought=70）
   - 添加止损保护

---

## 参数预设方案

### 方案1：标准版（默认）
```json
{
  "period": 9,
  "oversold": 30,
  "overbought": 70,
  "timeframe": "D"
}
```
- 特点：经典KDJ设置
- 适合：普通散户，短线波段交易
- 预期：交易频率中等，胜率55-65%

### 方案2：激进版（高频短线）
```json
{
  "period": 5,
  "oversold": 40,
  "overbought": 60,
  "timeframe": "D"
}
```
- 特点：灵敏度极高，快进快出
- 适合：日内交易者，频繁盯盘
- 预期：交易频率高，单次收益小，需严格执行

### 方案3：稳健版（高胜率）
```json
{
  "period": 14,
  "oversold": 20,
  "overbought": 80,
  "timeframe": "D"
}
```
- 特点：深度超卖才买入，信号质量高
- 适合：稳健投资者，不追求频繁交易
- 预期：胜率70%+，但交易机会少（年化10-20次）

### 方案4：趋势确认版
```json
{
  "period": 9,
  "oversold": 30,
  "overbought": 70,
  "require_j_confirm": true,
  "timeframe": "D"
}
```
- 特点：要求J值也在超卖区（三线共振）
- 适合：追求高质量信号的投资者
- 预期：假信号显著减少

**注意**：`require_j_confirm`参数需要在Phase 2实现。

---

## 常见问题与优化

### Q1: KDJ钝化问题（长期超买/超卖）
**答**：强趋势中KDJ可能长时间钝化

**现象**：
- 强下跌：K、D值长期<20，不断金叉死叉，信号失效
- 强上涨：K、D值长期>80，不进入超卖区，无买入信号

**优化方案**：
1. **趋势过滤**：
   - 仅在价格位于MA(20)上方时交易超卖反弹
   - 强下跌趋势中暂停交易

2. **多周期确认**：
   - 日线KDJ超卖 + 周线KDJ>30（趋势健康）→ 可靠信号

3. **时间止损**：
   - 买入后N天不反弹则止损（如3-5天）

### Q2: 频繁金叉死叉（震荡市）
**答**：震荡市中KDJ会频繁交叉

**优化方案**：
1. **交易间隔限制**：
   - 卖出后5天内不再买入
   - 避免高频交易

2. **提高阈值严格性**：
   - 震荡市使用oversold=20, overbought=80

3. **增加K、D距离要求**：
   - 金叉时要求K>D至少2-3点
   - 避免"假金叉"

### Q3: 卖出时机不佳
**答**：当前卖出逻辑为"K值进入超买区"，可能卖早

**优化方案**：
1. **改用超买区死叉卖出**：
```
if K[t-1] >= D[t-1] and K[t] < D[t] and K[t] > overbought:
    signal = SELL
```

2. **分批卖出**：
   - K>70时卖出50%
   - K>80或死叉时卖出剩余50%

3. **移动止盈**：
   - 从超买区回落5-10点时卖出

---

## 高级优化方向（Phase 2/3）

### 1. J值确认（推荐实现）

**三线共振**：
```
买入条件：
  K上穿D（金叉）
  AND K < oversold
  AND J < oversold（J值也超卖）
  → 三条线都在超卖区，信号极强
```

### 2. KDJ形态识别

**底背离**：
```
价格创新低，但KDJ的K值不创新低
→ 底部反转信号增强
```

**顶背离**：
```
价格创新高，但KDJ的K值不创新高
→ 顶部反转信号增强
```

### 3. KDJ斜率分析

**快速金叉**：
```
金叉时K值上升斜率>5（快速拉升）
→ 反弹力度强，信号更可靠
```

**缓慢金叉**：
```
金叉时K值上升斜率<2（缓慢抬升）
→ 反弹力度弱，谨慎买入
```

---

## 与其他策略的组合

### 组合1：KDJ + 均线
```
买入条件：
  KDJ超卖区金叉 AND 价格在MA(20)上方
  → 短期超卖 + 中期趋势向上，安全边际高
```

### 组合2：KDJ + RSI
```
买入条件：
  KDJ金叉（K<30）AND RSI<30
  → 双重超卖确认，反弹概率大
```

### 组合3：KDJ + MACD
```
买入条件：
  KDJ金叉（K<30）AND MACD柱状图由负转正
  → 短期超卖 + 中期动能转好
```

### 组合4：KDJ + 成交量
```
买入条件：
  KDJ金叉（K<30）AND 成交量放大（>5日均量×1.5）
  → 量价配合，反弹有力
```

---

## 参数回测建议

### 参数搜索范围

```python
param_grid = {
    'period': [5, 7, 9, 12, 14],
    'oversold': [15, 20, 25, 30, 35, 40],
    'overbought': [60, 65, 70, 75, 80, 85]
}

# 约束条件
filter: oversold < 50
filter: overbought > 50
filter: overbought - oversold >= 25
```

### 评估指标

1. **胜率**：目标60%+
2. **盈亏比**：目标1.5:1以上
3. **交易频率**：年化30-60次为宜（日线级别）
4. **最大回撤**：控制在12%以内

---

## 风险控制建议

### 1. 止损设置（重要！）
```json
{
  "stop_loss_pct": 0.05,     // 下跌5%止损
  "time_stop_days": 3,       // 3天不反弹止损
  "kdj_stop": true           // 金叉后快速死叉止损
}
```

### 2. 仓位控制
```json
{
  "position_size": 0.25,     // 单次25%仓位
  "max_positions": 3,        // 最多持有3只
  "scale_by_kdj": true       // K值越低，仓位越大
}
```

**仓位分配示例**：
- K=28 → 25%仓位
- K=20 → 35%仓位（深度超卖，加大仓位）
- K=15 → 40%仓位（极度超卖）

### 3. 持仓时间控制
```json
{
  "max_hold_days": 10,       // 最长持有10天
  "min_hold_days": 1         // 最短持有1天（避免当天买当天卖）
}
```

---

## 实现优先级

### Phase 1（已实现）✅
- ✅ 基础KDJ计算（固定period=9）
- ✅ 超卖超买阈值可配置
- ✅ 超卖区金叉买入逻辑
- ✅ 超买区卖出逻辑

### Phase 2（建议实现）📋
- 📋 KDJ period参数可配置
- 📋 J值确认机制
- 📋 超买区死叉卖出（替代当前简单超买卖出）
- 📋 止损止盈设置
- 📋 KDJ背离检测

### Phase 3（高级功能）⭕
- ⭕ KDJ斜率分析
- ⭕ 多周期KDJ共振
- ⭕ KDJ形态识别
- ⭕ 动态仓位管理

---

## 参数校验规则

```python
def validate_params(params):
    oversold = params['oversold']
    overbought = params['overbought']
    period = params.get('period', 9)

    assert 5 <= period <= 30, "KDJ周期必须在5-30之间"
    assert 10 <= oversold <= 40, "超卖阈值必须在10-40之间"
    assert 60 <= overbought <= 90, "超买阈值必须在60-90之间"
    assert overbought > oversold, "超买阈值必须大于超卖阈值"
    assert overbought - oversold >= 25, "超买超卖阈值差距至少25"

    return True
```

---

## 性能考虑

1. **计算复杂度**：O(n)，高效
2. **实时性**：适合每日全市场扫描
3. **内存占用**：需存储K、D、J三条线，占用略高于单指标

---

## 与其他指标的对比

| 指标 | 灵敏度 | 钝化问题 | 适用场景 | 与KDJ的区别 |
|------|-------|---------|---------|------------|
| RSI | 中 | 中等 | 超买超卖反转 | RSI单线，KDJ三线交叉信号更明确 |
| MACD | 低 | 较少 | 趋势跟踪 | MACD滞后，KDJ更灵敏 |
| KDJ | 高 | 严重 | 短期买卖时机 | KDJ最灵敏，但假信号也最多 |

**结论**：KDJ适合短线交易，但需要严格的过滤和止损。

---

## 文档变更记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2025-11-11 | 初始版本，定义KDJ Cross策略所有参数 |
