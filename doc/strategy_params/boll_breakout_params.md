# Bollinger Bands Breakout 策略参数设计文档

**策略ID**: `boll_breakout`
**策略名称**: 布林带突破
**文档版本**: v1.0
**创建日期**: 2025-11-11

---

## 参数设计概述

本文档定义了布林带突破策略的所有可配置参数。布林带（Bollinger Bands）由约翰·布林格（John Bollinger）在1980年代发明，是最经典的波动性指标之一，广泛应用于识别超买超卖状态和波动性变化。

---

## 布林带指标原理简述

### 指标构成
- **中轨（Middle Band）**：N日简单移动平均线（SMA）
- **上轨（Upper Band）**：中轨 + K × 标准差
- **下轨（Lower Band）**：中轨 - K × 标准差

### 默认参数
- N = 20（周期）
- K = 2（标准差倍数）

### 核心逻辑
- **价格触及/突破下轨**：超卖，可能反弹（买入信号）
- **价格触及/突破上轨**：超买，可能回调（卖出信号）
- **带宽收窄**：波动率降低，酝酿突破
- **带宽扩张**：波动率上升，趋势强化

---

## 参数分类

### 1. 基础参数

#### 1.1 时间周期

| 参数名 | 类型 | 默认值 | 可选值 | 说明 |
|--------|------|--------|--------|------|
| `timeframe` | select | `D` | `D`(日线), `W`(周线) | 策略运行的时间周期 |

---

#### 1.2 布林带计算参数

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `period` | integer | 20 | 10-60 | 布林带周期（中轨MA周期） |
| `std_dev` | float | 2.0 | 1.0-3.0 | 标准差倍数（K值） |

**设计说明**：
- **period（周期）**：
  - 默认20天：经典设置，适合大多数情况
  - 短周期（10-15天）：更灵敏，适合短线，但假信号多
  - 长周期（30-50天）：更稳定，适合波段，但滞后

- **std_dev（标准差倍数）**：
  - 默认2.0：标准设置，包含约95%的价格波动
  - 1.5-1.8：带宽收窄，信号更频繁但质量降低
  - 2.5-3.0：带宽扩大，信号更少但质量更高

**注意**：当前代码中这两个参数尚未暴露给用户，使用固定默认值。建议在Phase 2添加。

---

## 信号生成逻辑（当前实现）

### 买入信号（突破下轨）
```
条件：价格从上方突破下轨（触及或跌破）

逻辑：
  if close[t-1] > lower[t-1] and close[t] <= lower[t]:
      signal = BUY

理由：价格触及下轨，处于超卖状态，可能反弹
```

### 卖出信号（突破上轨）
```
条件：价格从下方突破上轨（触及或突破）

逻辑：
  if close[t-1] < upper[t-1] and close[t] >= upper[t]:
      signal = SELL

理由：价格触及上轨，处于超买状态，可能回调
```

**注意**：这是"均值回归"策略（Mean Reversion），假设价格偏离均值后会回归。

---

## 策略类型与变种

布林带策略有两种主要类型，当前实现的是第一种：

### 类型1：均值回归策略（当前实现）
- **逻辑**：价格触及下轨买入，触及上轨卖出
- **假设**：价格会向中轨回归
- **适用**：震荡市、区间交易
- **风险**：趋势市中可能"接飞刀"或"卖飞"

### 类型2：突破跟随策略（建议Phase 2实现）
- **逻辑**：价格突破上轨买入（趋势加强），跌破下轨卖出（趋势转弱）
- **假设**：强突破后趋势延续
- **适用**：趋势市、突破行情
- **风险**：震荡市中频繁止损

**建议**：添加参数`strategy_type`让用户选择使用哪种逻辑。

---

## 参数设计扩展（Phase 2）

### 2. 布林带计算参数（待实现）

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `period` | integer | 20 | 10-60 | 布林带周期 |
| `std_dev` | float | 2.0 | 1.0-3.0 | 标准差倍数 |

---

### 3. 策略类型选择（待实现）

| 参数名 | 类型 | 默认值 | 可选值 | 说明 |
|--------|------|--------|--------|------|
| `strategy_type` | select | `mean_reversion` | `mean_reversion`, `breakout` | 策略类型 |

**可选值说明**：
- `mean_reversion`：均值回归（触及下轨买入，触及上轨卖出）
- `breakout`：突破跟随（突破上轨买入，跌破下轨卖出）

---

### 4. 信号过滤参数（待实现）

#### 4.1 带宽过滤

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `use_bandwidth_filter` | boolean | false | 是否启用带宽过滤 |
| `min_bandwidth` | float | 0.02 | 最小带宽（带宽<此值时不交易） |

**设计说明**：
- 带宽 = (上轨 - 下轨) / 中轨
- 带宽过小（<2%）= 波动率极低，布林带收敛，可能酝酿大行情
- 过滤逻辑：带宽过小时暂停交易，等待突破方向确认

#### 4.2 趋势过滤

| 参数名 | 类型 | 默认值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `trend_ma_period` | integer | 0 | 0, 50-200 | 趋势过滤均线周期（0=不启用） |
| `trend_position` | select | `above` | `above`, `below`, `any` | 价格相对趋势均线的位置 |

**设计说明**：
- 仅在价格位于长期均线上方时交易下轨反弹（避免下跌趋势中接飞刀）
- 例如：只在MA(200)上方交易，确保大趋势向上

#### 4.3 回归确认

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `require_mean_reversion` | boolean | false | 是否要求价格回归中轨 |
| `reversion_threshold` | float | 0.5 | 回归阈值（0-1，表示回归到中轨的比例） |

**设计说明**：
- 触及下轨后，等待价格至少回升到中轨一半位置才确认买入
- 避免"接飞刀"（价格触及下轨后继续下跌）

---

## 参数优化建议

### 优化目标维度

1. **提高胜率（均值回归）**：
   - 使用std_dev=2.5（更严格的超买超卖）
   - 添加趋势过滤（只在上升趋势中做下轨反弹）
   - 添加回归确认（价格必须反弹才买入）

2. **捕捉突破（突破跟随）**：
   - 使用较窄的带宽（std_dev=1.5）
   - 检测带宽收窄后的突破
   - 结合成交量确认

3. **平衡（混合策略）**：
   - 震荡市用均值回归
   - 趋势市用突破跟随
   - 使用ADX或ATR判断市场类型

---

## 参数预设方案

### 方案1：标准均值回归（默认）
```json
{
  "period": 20,
  "std_dev": 2.0,
  "strategy_type": "mean_reversion",
  "timeframe": "D"
}
```
- 特点：经典布林带设置
- 适合：震荡市、区间交易
- 预期：胜率55-60%，适合波动性适中的股票

### 方案2：激进均值回归
```json
{
  "period": 20,
  "std_dev": 1.5,
  "strategy_type": "mean_reversion",
  "timeframe": "D"
}
```
- 特点：带宽收窄，信号更频繁
- 适合：高波动股票，短线交易
- 预期：交易频率高，单次收益小

### 方案3：稳健均值回归
```json
{
  "period": 20,
  "std_dev": 2.5,
  "strategy_type": "mean_reversion",
  "trend_ma_period": 200,
  "trend_position": "above",
  "timeframe": "D"
}
```
- 特点：带宽扩大+趋势过滤，信号质量高
- 适合：稳健投资者，只在上升趋势中做超卖反弹
- 预期：胜率65%+，但交易频率低

### 方案4：突破跟随
```json
{
  "period": 20,
  "std_dev": 2.0,
  "strategy_type": "breakout",
  "use_bandwidth_filter": true,
  "min_bandwidth": 0.02,
  "timeframe": "D"
}
```
- 特点：带宽收窄后突破方向跟随
- 适合：趋势市，捕捉大行情
- 预期：胜率40-50%，但盈亏比高（2:1以上）

### 方案5：短周期敏感型
```json
{
  "period": 10,
  "std_dev": 1.8,
  "strategy_type": "mean_reversion",
  "timeframe": "D"
}
```
- 特点：更灵敏，适合短线
- 适合：日内波段，频繁交易者
- 预期：交易频繁，需严格止损

---

## 常见问题与优化

### Q1: 趋势市中频繁止损（接飞刀/卖飞）
**答**：这是均值回归策略的固有缺陷

**优化方案**：
1. **趋势过滤**：
   - 仅在价格位于MA(200)上方时做下轨反弹
   - 强下跌趋势中暂停交易

2. **切换策略**：
   - 检测趋势强度（如ADX>25）
   - 趋势市用突破跟随，震荡市用均值回归

3. **严格止损**：
   - 触及下轨买入后，如果继续跌破下轨5%，止损

### Q2: 震荡市中突破策略频繁假突破
**答**：震荡市中真突破少，假突破多

**优化方案**：
1. **带宽过滤**：
   - 仅在带宽收窄后扩张时交易突破
   - 带宽持续收窄<2%时，警惕即将突破

2. **成交量确认**：
   - 突破时要求成交量放大（>5日均量×1.5）
   - 无量突破通常是假突破

3. **突破幅度要求**：
   - 要求收盘价突破上轨至少0.5%-1%
   - 避免"假突破"（刚穿过就回落）

### Q3: 如何识别"挤压"（Squeeze）后的爆发？
**答**：布林带挤压是强烈的波动率扩张前兆

**优化方案**：
1. **检测带宽收窄**：
   - 计算20日带宽的最小值
   - 当带宽接近历史最小值时，预警

2. **等待突破方向确认**：
   - 不在挤压期间交易
   - 等待价格突破上轨或下轨后跟随

3. **大仓位跟随**：
   - 挤压后突破的行情通常幅度大
   - 可适当加大仓位

---

## 高级优化方向（Phase 2/3）

### 1. 布林带挤压检测（推荐实现）

**挤压定义**：
```
带宽 = (上轨 - 下轨) / 中轨
挤压 = 带宽 < 近20日带宽最小值 × 1.1

信号：
  挤压状态下，等待突破方向
  突破上轨 → 买入（看涨）
  跌破下轨 → 卖空或观望（看跌）
```

### 2. 布林带%B指标

**%B定义**：
```
%B = (close - 下轨) / (上轨 - 下轨)

取值范围：
  %B > 1: 价格在上轨之上（超买）
  %B = 0.5: 价格在中轨
  %B < 0: 价格在下轨之下（超卖）

用法：
  %B < 0.2: 接近下轨，超卖
  %B > 0.8: 接近上轨，超买
```

### 3. 布林带与其他指标的结合

**布林带 + RSI**：
```
买入条件：
  价格触及下轨 AND RSI < 30
  → 双重超卖确认
```

**布林带 + MACD**：
```
买入条件：
  价格触及下轨 AND MACD金叉
  → 超卖 + 动能转好
```

---

## 与其他策略的组合

### 组合1：布林带 + 均线
```
买入条件：
  价格触及下轨 AND 价格在MA(50)上方
  → 短期超卖 + 中期趋势向上
```

### 组合2：布林带 + KDJ
```
买入条件：
  价格触及下轨 AND KDJ金叉（K<30）
  → 双重超卖反弹信号
```

### 组合3：布林带 + 成交量
```
买入条件：
  价格跌破下轨 AND 成交量萎缩（<5日均量×0.7）
  → 恐慌性下跌尾声，即将反弹
```

---

## 参数回测建议

### 参数搜索范围

```python
param_grid = {
    'period': [10, 15, 20, 25, 30],
    'std_dev': [1.5, 1.8, 2.0, 2.2, 2.5, 3.0],
    'strategy_type': ['mean_reversion', 'breakout']
}

# 分别回测两种策略类型
```

### 评估指标

**均值回归策略**：
- 胜率：目标55-65%
- 盈亏比：目标1.2:1以上
- 最大回撤：控制在15%以内

**突破跟随策略**：
- 胜率：目标40-50%
- 盈亏比：目标2:1以上
- 最大回撤：控制在20%以内

---

## 风险控制建议

### 1. 止损设置

**均值回归策略止损**：
```json
{
  "stop_loss_pct": 0.05,        // 下跌5%止损
  "stop_loss_band_break": 0.05  // 继续跌破下轨5%止损
}
```

**突破跟随策略止损**：
```json
{
  "stop_loss_pct": 0.08,        // 下跌8%止损
  "stop_loss_reenter_band": true // 突破后回落进入带内止损
}
```

### 2. 仓位控制
```json
{
  "position_size": 0.3,         // 单次30%仓位
  "scale_by_bandwidth": true    // 带宽越窄，仓位越大（挤压行情）
}
```

---

## 实现优先级

### Phase 1（已实现）✅
- ✅ 基础布林带计算（固定period=20, std_dev=2.0）
- ✅ 均值回归策略（触及下轨买入，触及上轨卖出）

### Phase 2（建议实现）📋
- 📋 period和std_dev参数可配置
- 📋 strategy_type选择（均值回归/突破跟随）
- 📋 带宽过滤
- 📋 趋势过滤
- 📋 止损止盈设置

### Phase 3（高级功能）⭕
- ⭕ 布林带挤压检测
- ⭕ %B指标
- ⭕ 带宽历史分析
- ⭕ 动态参数调整（根据波动率）

---

## 参数校验规则

```python
def validate_params(params):
    period = params.get('period', 20)
    std_dev = params.get('std_dev', 2.0)

    assert 10 <= period <= 60, "布林带周期必须在10-60之间"
    assert 1.0 <= std_dev <= 3.0, "标准差倍数必须在1.0-3.0之间"
    assert params['timeframe'] in ['D', 'W'], "时间周期必须是D或W"

    return True
```

---

## 性能考虑

1. **计算复杂度**：O(n)，需要计算移动平均和标准差
2. **内存占用**：需存储上轨、中轨、下轨三条线
3. **实时性**：适合每日全市场扫描

---

## 文档变更记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2025-11-11 | 初始版本，定义Bollinger Bands策略所有参数 |
