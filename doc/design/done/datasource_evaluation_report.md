# 数据源评估报告

**评估日期**: 2025-11-20
**评估人员**: 开发团队
**关联项目**: 多数据源适配器扩展

---

## 1. 评估概述

本报告对候选数据源进行了实际测试和评估,目的是为多数据源适配器扩展项目选择合适的数据源。

**评估维度:**
- ✅ 稳定性: API是否稳定可用
- ⏱️ 响应速度: 数据获取的响应时间
- 🔑 认证要求: 是否需要注册和API密钥
- 🌍 市场覆盖: 支持的市场类型
- 📊 数据质量: 数据完整性和准确性
- 💰 免费额度: 是否有调用限制

---

## 2. 已测试数据源

### 2.1 Baostock (证券宝)

**测试状态**: ✅ 通过

#### 基本信息
- **官网**: http://baostock.com
- **市场覆盖**: A股(沪深)
- **需要认证**: 否
- **免费额度**: 无限制
- **Python库**: `baostock`

#### 测试结果

**测试1: 获取A股历史数据**
- 股票: 平安银行(000001)
- 时间范围: 2023-01-01 ~ 2023-12-31
- 数据行数: 242行
- 响应时间: **351ms**
- 状态: ✅ 成功
- 返回字段: date, code, open, high, low, close, volume

**测试2: 获取股票列表**
- 总股票数: 7,150只
- 响应时间: **339ms**
- 状态: ✅ 成功
- 支持搜索: 是

#### 优势
- ✅ 无需注册,开箱即用
- ✅ 响应速度快(~350ms)
- ✅ 稳定性好,登录成功率100%
- ✅ 数据完整,覆盖A股全市场
- ✅ 接口简单,易于集成

#### 劣势
- ❌ 仅支持A股,不支持港股/美股
- ❌ 实时数据支持有限
- ❌ 日期格式要求YYYY-MM-DD(与AkShare不同)

#### 评估结论
**优先级: 高 (推荐第一批实施)**

**推荐理由:**
- 稳定性好,响应速度快
- 无需认证,降低接入门槛
- 可作为AkShare的优质备选

**推荐用途:**
- A股市场的主力/备用数据源
- 优先级: 2 (仅次于AkShare)

---

### 2.2 Tushare Pro

**测试状态**: ⚠️ 需要Token

#### 基本信息
- **官网**: https://tushare.pro
- **市场覆盖**: A股(沪深)
- **需要认证**: 是 (需要Token)
- **免费额度**: 基于积分制
- **Python库**: `tushare`

#### 测试结果

**注册要求:**
- 注册即可获得120积分
- 不同接口需要不同积分权限
- 积分可通过任务获取

**未完成测试项:**
- 获取股票数据 - 需要Token
- 搜索股票 - 需要Token
- 响应时间 - 未知

#### 优势
- ✅ 数据质量高,量化平台首选
- ✅ 功能丰富,支持多种数据类型
- ✅ 社区活跃,文档完善
- ✅ 稳定性好,专业团队维护

#### 劣势
- ❌ 需要注册和Token
- ❌ 积分制限制,部分接口需要高积分
- ❌ 对散户用户有一定门槛
- ❌ 高频调用可能需要付费

#### 评估结论
**优先级: 中 (推荐第二批实施)**

**推荐理由:**
- 数据质量高,可靠性强
- 适合对数据质量要求高的场景
- 可作为高级数据源选项

**推荐用途:**
- A股市场的高质量备选数据源
- 优先级: 3-4 (需要配置Token)

**接入建议:**
- 提供配置选项让用户输入Token
- 检测Token有效性
- 积分不足时友好提示

---

### 2.3 AkShare (港股扩展测试)

**测试状态**: ✅ 通过 (但有性能问题)

#### 基本信息
- **市场覆盖**: A股 + 港股 + 美股
- **已集成**: 是 (当前系统已使用)

#### 港股测试结果

**测试1: 获取港股实时行情**
- 总股票数: 2,708只
- 响应时间: **19,410ms** (19.4秒)
- 状态: ✅ 成功但较慢
- 列名: 与A股不同,需要适配

**测试2: 获取港股历史数据**
- 股票: 腾讯控股(00700)
- 时间范围: 2023-01-01 ~ 2023-12-31
- 数据行数: 243行
- 响应时间: **573ms**
- 状态: ✅ 成功

#### 发现
- ✅ 支持港股数据
- ⚠️ 港股实时行情响应很慢(19秒)
- ⚠️ 港股列名与A股不同
  - A股: '代码', '名称'
  - 港股: '代码', '中文名称', '英文名称'
- ✅ 港股历史数据响应正常(~600ms)

#### 评估结论
**港股支持**: 可用但需优化

**建议:**
- 港股实时行情慢,避免频繁调用
- 历史数据可正常使用
- 需要统一数据格式(列名映射)

---

## 3. 未测试数据源

### 3.1 AllTick

**状态**: 未测试
**原因**: 需要注册获取API Key

**待评估:**
- 免费版调用限制
- 港股数据质量
- 响应时间

**优先级**: 中

---

### 3.2 Infoway

**状态**: 未测试
**原因**: 文档不够明确,需要进一步调研

**待评估:**
- 免费额度
- API文档质量
- 稳定性

**优先级**: 低

---

### 3.3 NowAPI

**状态**: 未测试
**原因**: 流量包机制不明确

**待评估:**
- 免费流量包额度
- 调用限制
- 实际可用性

**优先级**: 低

---

## 4. 数据源对比

### 4.1 性能对比

| 数据源 | 获取数据响应时间 | 搜索股票响应时间 | 评价 |
|--------|------------------|------------------|------|
| Baostock | 351ms | 339ms | ⭐⭐⭐⭐⭐ 优秀 |
| AkShare (A股) | ~500ms | ~500ms | ⭐⭐⭐⭐ 良好 |
| AkShare (港股) | 573ms (历史) | 19,410ms (实时) | ⭐⭐ 慢 |
| Tushare | 未测试 | 未测试 | - |

### 4.2 功能对比

| 数据源 | A股 | 港股 | 美股 | 需要认证 | 免费额度 |
|--------|-----|------|------|----------|----------|
| AkShare | ✅ | ✅ | ✅ | ❌ | 无限制 |
| Baostock | ✅ | ❌ | ❌ | ❌ | 无限制 |
| YFinance | ✅ | ✅ | ✅ | ❌ | 无限制 |
| Tushare | ✅ | ❌ | ❌ | ✅ | 积分制 |
| AllTick | ✅ | ✅ | ❌ | ✅ | 待确认 |

### 4.3 综合评分

| 数据源 | 稳定性 | 速度 | 覆盖面 | 易用性 | 总分 |
|--------|--------|------|--------|--------|------|
| Baostock | 9 | 10 | 6 | 10 | **35/40** ⭐⭐⭐⭐⭐ |
| AkShare | 8 | 7 | 10 | 9 | **34/40** ⭐⭐⭐⭐⭐ |
| YFinance | 9 | 8 | 10 | 9 | **36/40** ⭐⭐⭐⭐⭐ |
| Tushare | 9 | ? | 7 | 6 | **22/40** ⭐⭐⭐ |

---

## 5. 推荐实施方案

### 5.1 第一批实施 (高优先级)

**推荐数据源:**

1. **Baostock (新增)**
   - 市场: A股
   - 优先级: 2 (仅次于AkShare)
   - 理由: 稳定快速,无需认证,优质备选

2. **保持现有: AkShare + YFinance**
   - 已集成,稳定可用
   - 调整优先级配置

**第一批实施后的数据源配置:**

```
A股市场优先级:
1. AkShare (主力)
2. Baostock (备用) ← 新增
3. YFinance (备用)

港股市场优先级:
1. YFinance (主力)
2. AkShare (备用,注意慢)

美股市场优先级:
1. YFinance (主力)
2. AkShare (备用)
```

### 5.2 第二批实施 (中优先级)

**可选数据源:**

1. **Tushare**
   - 需要用户配置Token
   - 提供更高数据质量选项
   - 优先级: 3-4 (A股)

2. **AllTick** (待评估)
   - 如果免费版足够好
   - 可作为港股补充

### 5.3 不推荐实施

- Infoway: 文档不清晰,优先级低
- NowAPI: 流量包机制不明确,优先级低

---

## 6. 技术发现和建议

### 6.1 数据格式统一问题

**发现:**
- 不同数据源的列名不同
  - Baostock: date, code, open, high, low, close, volume
  - AkShare: 日期, 开盘, 收盘, 最高, 最低, 成交量
  - AkShare港股: 中文名称 vs 名称

**建议:**
- 适配器层必须做数据标准化
- 统一列名为英文: date, open, high, low, close, volume
- 统一日期格式: datetime64[ns]
- 统一股票代码格式

### 6.2 日期格式问题

**发现:**
- AkShare: YYYYMMDD (如 20230101)
- Baostock: YYYY-MM-DD (如 2023-01-01)
- Tushare: YYYYMMDD

**建议:**
- 适配器内部处理日期格式转换
- 对外统一使用 datetime 对象

### 6.3 性能优化建议

**港股实时行情慢的问题:**
- AkShare港股实时行情响应19秒
- 建议: 避免实时查询,使用历史数据或缓存
- 替代: 优先使用YFinance获取港股数据

---

## 7. 下一步行动

### 7.1 立即行动 (本周)

- [x] ~~完成Baostock测试~~
- [ ] 实施Baostock适配器
- [ ] 更新requirements.txt添加baostock
- [ ] 编写Baostock单元测试

### 7.2 短期行动 (下周)

- [ ] 注册Tushare账号获取Token
- [ ] 完成Tushare测试
- [ ] 决定是否实施Tushare适配器

### 7.3 可选行动

- [ ] 评估AllTick免费版
- [ ] 测试其他候选数据源

---

## 8. 风险和注意事项

### 8.1 技术风险

**风险1: 免费数据源稳定性**
- 风险: Baostock可能停止服务或限流
- 缓解: 保持多数据源冗余,至少3个A股数据源

**风险2: 数据一致性**
- 风险: 不同数据源数据可能有差异
- 缓解: 优先使用可靠数据源,记录数据来源

### 8.2 性能风险

**风险: 港股数据获取慢**
- 现状: AkShare港股实时行情19秒
- 影响: 用户体验差
- 缓解: 优先使用YFinance,避免AkShare实时查询

---

## 9. 附录

### 9.1 测试命令记录

**Baostock测试:**
```bash
docker exec stock-backtest-backend python3 -c "
import baostock as bs
bs.login()
rs = bs.query_history_k_data_plus('sz.000001', ...)
"
```

**AkShare港股测试:**
```bash
docker exec stock-backtest-backend python3 -c "
import akshare as ak
hk_spot = ak.stock_hk_spot()
hk_hist = ak.stock_hk_hist(symbol='00700', ...)
"
```

### 9.2 相关文档

- 详细设计: `doc/design/multi_datasource_adapter_design.md`
- 开发计划: `doc/design/multi_datasource_adapter_implementation_plan.md`
- Backlog: `doc/backlog/多数据源适配器扩展.md`

---

**报告状态**: 初步完成
**更新时间**: 2025-11-20
**下次更新**: 完成Tushare测试后
